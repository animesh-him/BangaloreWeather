<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Aerospace Park â€” Weather Dashboard</title>

<!-- Libraries -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<style>
  /* Theme variables: default light mode */
  :root{
    --bg-gradient-from: #f7f9fc;
    --bg-gradient-to: #f4f6f9;
    --page-text: #07101a;
    --card-bg: #ffffff;
    --muted: #556070;
    --accent: #b22222;
    --ok: #2e7d32;
    --warn: #ff9800;
    --bad: #d32f2f;
    --card-shadow: 0 8px 30px rgba(16,24,40,0.06);
    --input-bg: rgba(255,255,255,0.98);
    --table-border: rgba(16,24,40,0.05);
    --map-border: rgba(16,24,40,0.04);
  }
  /* Dark theme */
  [data-theme="dark"]{
    --bg-gradient-from: #071017;
    --bg-gradient-to: #081424;
    --page-text: #e6f0f8;
    --card-bg: #0f1720;
    --muted: #a8bac8;
    --accent: #ff6b6b;
    --ok: #66e08b;
    --warn: #ffb86b;
    --bad: #ff8080;
    --card-shadow: 0 8px 30px rgba(0,0,0,0.6);
    --input-bg: rgba(20,26,32,0.6);
    --table-border: rgba(255,255,255,0.04);
    --map-border: rgba(255,255,255,0.06);
  }

  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-gradient-from),var(--bg-gradient-to));font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:var(--page-text)}
  .wrap{max-width:1000px;margin:18px auto;padding:12px}
  header{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  h1{margin:0;font-size:20px;color:var(--accent)}
  .subtitle{color:var(--muted);font-size:13px}
  .controls{margin-left:auto;display:flex;gap:8px;align-items:center;flex-wrap:wrap}

  input,select,button{
    padding:8px 10px;border-radius:8px;border:1px solid rgba(0,0,0,0.05);
    background:var(--input-bg);font-size:13px;color:var(--page-text);
    backdrop-filter: blur(6px);
  }
  button.primary{background:var(--accent);color:#fff;border:none}
  .grid{display:grid;grid-template-columns:1fr 380px;gap:14px;margin-top:14px}
  @media(max-width:980px){.grid{grid-template-columns:1fr}}
  .card{background:var(--card-bg);border-radius:12px;padding:12px;box-shadow:var(--card-shadow);color:var(--page-text)}
  th,td{padding:6px;border:1px solid var(--table-border);text-align:left;font-size:13px;vertical-align:top}
  th{background:rgba(0,0,0,0.02);width:36%}
  #map{height:180px;border-radius:8px;margin-top:8px;border:1px solid var(--map-border)}
  .hidden{display:none}
</style>
</head>
<body>
  <div class="wrap" id="pageRoot">
    <header>
      <div>
        <h1>ðŸŒ¤ Aerospace Park â€” Weather Dashboard</h1>
        <div class="subtitle">Open-Meteo forecast â€¢ IMD advisory. Default: light mode.</div>
      </div>
      <div class="controls">
        <button id="themeBtn" class="toggle">ðŸŒ“</button>
      </div>
    </header>

    <main class="grid">
      <section>
        <div id="dashboardCard" class="card">Loadingâ€¦</div>
        <div class="card" style="margin-top:12px">
          <div style="font-weight:700">Map</div>
          <div id="map"></div>
        </div>
      </section>

      <aside>
        <!-- IMD card starts hidden -->
        <div class="card hidden" id="imdCard">
          <div style="font-weight:700">IMD Advisory</div>
          <div id="imdBox" style="margin-top:8px"></div>
          <div id="imdNote" class="small muted" style="margin-top:8px"></div>
        </div>
      </aside>
    </main>
  </div>

<script>
const DEFAULT = { name:"Aerospace Park, Bangalore", lat:12.9896, lon:77.6387 };
const el = id => document.getElementById(id);
const root = document.documentElement;

/* Theme: default light */
if(localStorage.getItem('theme')==='dark') root.setAttribute('data-theme','dark');
el('themeBtn').addEventListener('click',()=> {
  if(root.getAttribute('data-theme')==='dark'){ root.removeAttribute('data-theme'); localStorage.setItem('theme','light'); }
  else { root.setAttribute('data-theme','dark'); localStorage.setItem('theme','dark'); }
});

/* Advisory table rendering */
function makeHeading(sentence){
  if(!sentence) return 'Advisory';
  return sentence.trim().split(/\s+/).slice(0,4).join(' ');
}
function renderIMDTable(imdData){
  const card = el('imdCard'); const box = el('imdBox');
  if(!imdData || !imdData.imd_bengaluru){ card.classList.add('hidden'); return; }
  const warnings = Array.isArray(imdData.imd_bengaluru.warnings) ? imdData.imd_bengaluru.warnings.filter(Boolean) : [];
  if(warnings.length===0){ card.classList.add('hidden'); return; }
  let html = '<table><tbody>';
  warnings.forEach(w=>{
    html += `<tr><th>${makeHeading(w)}</th><td>${w}</td></tr>`;
  });
  html += '</tbody></table>';
  box.innerHTML = html;
  el('imdNote').innerText = `Source: IMD â€¢ Updated: ${imdData.fetched_at||'â€”'}`;
  card.classList.remove('hidden');
}

/* Dummy loader for demo â€” replace with your real fetch */
async function loadAll(){
  const r = await fetch('./imd.json?_=' + Date.now()); const j = await r.json();
  renderIMDTable(j);
}
loadAll();
</script>
</body>
</html>
