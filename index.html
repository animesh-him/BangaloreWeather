<!doctype html>
<html lang="en" data-theme="dark">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Weather Forecast</title>

<!-- Leaflet + Chart.js -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
  *,*::before,*::after{box-sizing:border-box}
  :root{
    --bg-from:#061018; --bg-to:#0a1625; --text:#f0f7ff; --muted:#96a3b0;
    --card:#0f1720; --accent:#ff6b6b; --ok:#66e08b; --border:rgba(255,255,255,0.05);
    --sun:#FFD93D; --cloud:#FFFFFF; --cloud-stroke:#6b7a88;
    --rain-light:#62CFF4; --rain-heavy:#2196F3; --storm:#A855F7;
  }
  [data-theme="light"]{
    --bg-from:#f9fbfd; --bg-to:#f0f4f9; --text:#111; --muted:#444;
    --card:#fff; --accent:#b22222; --ok:#2e7d32; --sun:#FFC107;
  }

  html,body{margin:0;height:100%;background:linear-gradient(180deg,var(--bg-from),var(--bg-to));font-family:Inter,system-ui,sans-serif;color:var(--text)}
  .wrap{max-width:980px;margin:10px auto;padding:12px}

  h1{margin:0;font-size:22px;color:var(--accent)}
  .subtitle{font-size:13px;color:var(--muted)}
  header{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
  .controls{margin-left:auto;display:flex;gap:6px;flex-wrap:wrap}

  select,input,button{padding:6px 8px;border-radius:8px;border:1px solid var(--border);background:var(--card);color:var(--text);font-size:13px}
  .mini{padding:5px 8px;font-size:13px}
  .grid{display:grid;grid-template-columns:1fr 340px;gap:12px;margin-top:12px}
  @media(max-width:900px){.grid{grid-template-columns:1fr}}

  .card{background:var(--card);border-radius:10px;padding:12px;box-shadow:0 4px 12px rgba(0,0,0,0.4);margin-bottom:10px}
  .hl{font-weight:700}

  /* top current temps */
  .top-grid{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .temp-center{font-size:42px;font-weight:800}
  .summary-block{display:flex;align-items:center;gap:10px}
  .summary-icon{width:60px;height:60px;position:relative}

  /* hourly row */
  .hourly-row{display:flex;gap:6px;overflow-x:auto;margin-top:8px;padding-bottom:4px}
  .hourly-tile{min-width:68px;padding:6px;border-radius:8px;text-align:center;background:rgba(255,255,255,0.04);cursor:pointer}
  .hourly-tile.selected{outline:2px solid rgba(255,255,255,0.15)}

  .day-cards{display:flex;gap:8px;overflow-x:auto;padding:6px 0}
  .day-card{min-width:88px;padding:6px;border-radius:8px;text-align:center;background:rgba(255,255,255,0.04);cursor:pointer}
  .day-card.selected{outline:2px solid rgba(255,255,255,0.15)}

  #map{height:140px;border-radius:8px;margin-top:6px}

  /* animated raindrops */
  .drop{position:absolute;width:4px;height:10px;border-radius:2px;background:var(--rain-light);animation:fall 0.9s linear infinite}
  .drop.heavy{background:var(--rain-heavy);animation:fall 0.6s linear infinite}
  @keyframes fall{0%{top:0;opacity:1}100%{top:100%;opacity:0}}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Weather Forecast</h1>
      <div class="subtitle">Hourly â€¢ 5-Day â€¢ Open-Meteo</div>
    </div>
    <div class="controls">
      <select id="preset" class="mini">
        <option data-lat="13.128893" data-lon="77.649531">Aerospace Park</option>
        <option data-lat="12.9141" data-lon="74.8560">Mangalore</option>
        <option data-lat="17.3850" data-lon="78.4867">Hyderabad</option>
        <option data-lat="12.9699" data-lon="77.7499">Whitefield</option>
        <option data-lat="12.8386" data-lon="77.6771">Electronic City</option>
        <option data-lat="12.9165" data-lon="77.5716">JP Nagar</option>
        <option data-lat="12.9784" data-lon="77.7011">Marathahalli</option>
        <option data-lat="13.1986" data-lon="77.7066">Bengaluru Airport</option>
      </select>
      <input id="searchBox" placeholder="Search city" />
      <button id="searchBtn" class="mini">Go</button>
      <button id="themeBtn" class="mini">ðŸŒ“</button>
    </div>
  </header>

  <main class="grid">
    <section>
      <div class="card">
        <div class="top-grid">
          <div>
            <div>Low: <span id="lowTemp">--</span>Â°</div>
            <div class="temp-center" id="currentTemp">--Â°</div>
            <div>High: <span id="highTemp">--</span>Â°</div>
          </div>
          <div class="summary-block">
            <div class="summary-icon" id="dayIcon"></div>
            <div id="daySummary">Loading...</div>
          </div>
        </div>
        <div class="hourly-row" id="hourlyRow"></div>
      </div>

      <div class="card">
        <b>5-Day Overview</b>
        <div class="day-cards" id="dayCards"></div>
      </div>

      <div class="card"><b>Next 12 hours â€“ Temperature</b><canvas id="tempChart"></canvas></div>
      <div class="card"><b>Precipitation Probability (%)</b><canvas id="precipChart"></canvas></div>
      <div class="card" id="dayDetail"></div>
    </section>

    <aside>
      <div class="card">
        <b>Location</b>
        <div id="locName">Aerospace Park</div>
        <div id="coords" style="font-size:12px;color:var(--muted)">Lat: 13.128893 â€¢ Lon: 77.649531</div>
        <div id="map"></div>
      </div>
    </aside>
  </main>
</div>

<script>
const DEFAULT={name:"Aerospace Park",lat:13.128893,lon:77.649531};
const API="https://api.open-meteo.com/v1/forecast";
const GEO="https://geocoding-api.open-meteo.com/v1/search?name=";
const el=id=>document.getElementById(id);

/* theme toggle */
const root=document.documentElement;
el('themeBtn').onclick=()=>{root.toggleAttribute('data-theme');};

/* map */
const map=L.map('map',{center:[DEFAULT.lat,DEFAULT.lon],zoom:13,attributionControl:false});
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
let marker=L.marker([DEFAULT.lat,DEFAULT.lon]).addTo(map);

/* charts */
const tempChart=new Chart(el('tempChart').getContext('2d'),{type:'line',data:{labels:[],datasets:[{data:[],borderColor:'#ff9800'}]},options:{plugins:{legend:{display:false}},responsive:true}});
const precipChart=new Chart(el('precipChart').getContext('2d'),{type:'bar',data:{labels:[],datasets:[{data:[],backgroundColor:'#4da6ff'}]},options:{plugins:{legend:{display:false}},scales:{y:{max:100}},responsive:true}});

/* icon builder */
function icon(type,prob){
  if(type==='sun') return `<svg viewBox="0 0 24 24" width="48" fill="var(--sun)"><circle cx="12" cy="12" r="5"/></svg>`;
  if(type==='partly') return `<svg viewBox="0 0 24 24" width="48"><circle cx="8" cy="8" r="3" fill="var(--sun)"/><ellipse cx="16" cy="16" rx="6" ry="4" fill="var(--cloud)" stroke="var(--cloud-stroke)"/></svg>`;
  if(type==='cloud') return `<svg viewBox="0 0 24 24" width="48"><ellipse cx="12" cy="14" rx="8" ry="5" fill="var(--cloud)" stroke="var(--cloud-stroke)"/></svg>`;
  if(type==='rainLight') return `<div style="position:relative;width:48px;height:48px"><ellipse cx="24" cy="20" rx="14" ry="8" fill="var(--cloud)" stroke="var(--cloud-stroke)"/></div>`;
  if(type==='rainHeavy') return `<div style="position:relative;width:48px;height:48px"><ellipse cx="24" cy="20" rx="14" ry="8" fill="var(--cloud)" stroke="var(--cloud-stroke)"/></div>`;
  if(type==='storm') return `<svg viewBox="0 0 24 24" width="48"><ellipse cx="12" cy="14" rx="8" ry="5" fill="var(--cloud)" stroke="var(--cloud-stroke)"/><polygon points="11,15 9,20 13,20 11,24" fill="var(--storm)"/></svg>`;
  return '';
}
function addDrops(elm,count,heavy){
  elm.innerHTML+=Array.from({length:count},()=>`<div class="drop ${heavy?'heavy':''}" style="left:${Math.random()*90}%;animation-delay:${Math.random()}s"></div>`).join('');
}
function wcType(code,prob){
  if([65,82,95,96].includes(code)) return 'storm';
  if(prob>=60) return 'rainHeavy';
  if(prob>=20) return 'rainLight';
  if([3,45,48].includes(code)) return 'cloud';
  if([1,2].includes(code)) return 'partly';
  return 'sun';
}

/* fetch */
async function fetchWeather(lat,lon){
  const q=new URLSearchParams({latitude:lat,longitude:lon,hourly:'temperature_2m,precipitation_probability,weathercode',daily:'temperature_2m_max,temperature_2m_min,weathercode,precipitation_sum',timezone:'auto'});
  const r=await fetch(API+'?'+q);return r.json();
}

/* render */
async function loadAll(lat=DEFAULT.lat,lon=DEFAULT.lon,label=DEFAULT.name){
  el('locName').textContent=label; marker.setLatLng([lat,lon]); map.setView([lat,lon],13); el('coords').textContent=`Lat:${lat.toFixed(3)} â€¢ Lon:${lon.toFixed(3)}`;
  const d=await fetchWeather(lat,lon);

  const idx=new Date().getHours();
  const t=d.hourly.temperature_2m[idx], hi=d.daily.temperature_2m_max[0], lo=d.daily.temperature_2m_min[0];
  el('currentTemp').textContent=`${Math.round(t)}Â°`; el('highTemp').textContent=hi; el('lowTemp').textContent=lo;

  const prob=d.hourly.precipitation_probability[idx]; const code=d.hourly.weathercode[idx];
  const type=wcType(code,prob); el('dayIcon').innerHTML=icon(type,prob); if(type.includes('rain')) addDrops(el('dayIcon'),type==='rainHeavy'?6:3,type==='rainHeavy');
  el('daySummary').textContent=prob>=50?`High chance of rain (${prob}%)`:(prob>0?`Slight chance (${prob}%)`:'Clear');

  /* hourly */
  el('hourlyRow').innerHTML='';
  for(let i=0;i<12;i++){
    const temp=Math.round(d.hourly.temperature_2m[idx+i]); const pr=d.hourly.precipitation_probability[idx+i]; const c=wcType(d.hourly.weathercode[idx+i],pr);
    const tile=document.createElement('div'); tile.className='hourly-tile'; tile.innerHTML=`<div>${i===0?'Now':(idx+i)%24}:00</div><div>${icon(c,pr)}</div><div>${temp}Â°</div><div style="font-size:12px">${pr}%</div>`; if(c.includes('rain')) addDrops(tile.querySelector('div:nth-child(2)'),c==='rainHeavy'?5:2,c==='rainHeavy');
    el('hourlyRow').appendChild(tile);
  }

  /* 5-day */
  el('dayCards').innerHTML='';
  for(let i=0;i<5;i++){
    const hi=Math.round(d.daily.temperature_2m_max[i]); const lo=Math.round(d.daily.temperature_2m_min[i]);
    const pr=d.daily.precipitation_sum[i]; const c=wcType(d.daily.weathercode[i],pr*10);
    const card=document.createElement('div'); card.className='day-card'; card.innerHTML=`<div>${new Date(d.daily.time[i]).toLocaleDateString([], {weekday:'short'})}</div><div>${icon(c,pr)}</div><div>${hi}/${lo}</div>`; if(c.includes('rain')) addDrops(card.querySelector('div:nth-child(2)'),c==='rainHeavy'?5:2,c==='rainHeavy');
    el('dayCards').appendChild(card);
  }

  /* charts */
  const times=d.hourly.time.slice(idx,idx+12).map(t=>new Date(t).getHours()+":00");
  tempChart.data.labels=times; tempChart.data.datasets[0].data=d.hourly.temperature_2m.slice(idx,idx+12); tempChart.update();
  precipChart.data.labels=times; precipChart.data.datasets[0].data=d.hourly.precipitation_probability.slice(idx,idx+12); precipChart.update();
}

/* search */
el('searchBtn').onclick=async()=>{const q=el('searchBox').value.trim();if(!q)return;const r=await fetch(GEO+q);const j=await r.json();if(j.results&&j.results[0])loadAll(j.results[0].latitude,j.results[0].longitude,j.results[0].name);};
el('preset').onchange=e=>{const o=e.target.selectedOptions[0];loadAll(+o.dataset.lat,+o.dataset.lon,o.textContent);};

/* init */
loadAll();
</script>
</body>
</html>
